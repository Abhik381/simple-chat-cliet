<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Document</title>
    <style>
      * {
        padding: 0;
        margin: 0;
        box-sizing: border-box;
      }

      body,
      html {
        width: 100%;
        height: 100%;
        background: #181818;
        color: #fff;
        font-family: "Segoe UI", Arial, sans-serif;
      }

      main {
        max-width: 480px;
        margin: 0 auto;
        height: 100vh;
        display: flex;
        flex-direction: column;
        background: #222;
        border-radius: 0 0 16px 16px;
        box-shadow: 0 2px 12px rgba(0, 0, 0, 0.2);
      }

      header {
        padding: 18px 16px 12px 16px;
        background: #24292f;
        border-radius: 0 0 12px 12px;
        box-shadow: 0 1px 4px rgba(0, 0, 0, 0.08);
        text-align: left;
      }
      #userName {
        font-size: 1.2rem;
        font-weight: 600;
        color: #fff;
      }

      #messages {
        flex: 1;
        overflow-y: auto;
        padding: 16px 8px;
        background: #222;
      }
      #messageList {
        list-style: none;
        display: flex;
        flex-direction: column;
        gap: 10px;
      }
      .message {
        max-width: 75%;
        padding: 10px 14px;
        border-radius: 16px;
        font-size: 1rem;
        word-break: break-word;
        background: #333;
        color: #fff;
        align-self: flex-start;
        box-shadow: 0 1px 4px rgba(0, 0, 0, 0.08);
      }
      .message.sent {
        background: #007bff;
        color: #fff;
        align-self: flex-end;
      }

      footer#messageInput {
        display: flex;
        gap: 8px;
        padding: 12px 16px;
        background: #24292f;
        border-radius: 12px 12px 0 0;
        box-shadow: 0 -1px 4px rgba(0, 0, 0, 0.08);
      }
      #messageText {
        flex: 1;
        padding: 10px;
        border-radius: 8px;
        border: none;
        font-size: 1rem;
        background: #333;
        color: #fff;
        outline: none;
      }
      #sendMessage {
        padding: 10px 18px;
        border-radius: 8px;
        border: none;
        background: #007bff;
        color: #fff;
        font-size: 1rem;
        cursor: pointer;
        font-weight: 500;
        transition: background 0.2s;
      }
      #sendMessage:hover {
        background: #0056b3;
      }

      @media (max-width: 600px) {
        main {
          max-width: 100vw;
          border-radius: 0;
        }
        header,
        footer#messageInput {
          border-radius: 0;
        }
        #messages {
          padding: 8px 2px;
        }
      }
    </style>
    <link
    href="https://cdn.jsdelivr.net/npm/remixicon@4.5.0/fonts/remixicon.css"
    rel="stylesheet"
/>
  </head>
  <body>
    <main>
      <header>
        <i class="ri-arrow-left-line" id="back" onclick="history.back()"></i>
        <h3 id="userName"></h3>
      </header>
      <section id="messages">
        <ul id="messageList"></ul>
      </section>
      <footer id="messageInput">
        <input type="text" id="messageText" placeholder="Type a message..." />
        <button id="sendMessage">Send</button>
      </footer>
    </main>

    <script>
      let userId = localStorage.getItem("userId");
      let receiverId = location.search.split("=")[1];

      async function fetchUser() {
        try {
          let user = await fetch(
            `https://simple-chat-server-three.vercel.app/api/users/get-user-id/${receiverId}`
          );
          user = await user.json();
          document.getElementById("userName").textContent = user.name;
          fetchMessages();
        } catch (error) {
          console.error("Error fetching users:", error);
        }
      }

      async function fetchMessages() {
        try {
          let messages = await fetch(
            `https://simple-chat-server-three.vercel.app/api/messages/all?s=${userId}&r=${receiverId}`
          );
          messages = await messages.json();
          let messageList = document.getElementById("messageList");
          messageList.innerHTML = messages.map(messageTemplate).join("");
          
        } catch (error) {
          console.error("Error fetching messages:", error);
        }
      }
     
      async function createMessages(sms) {
        try {
          let payload = {
            senderId: userId,
            receiverId: receiverId,
            message: sms,
          };
          let messages = await fetch(
            `https://simple-chat-server-three.vercel.app/api/messages/create`,
            {
              method: "POST",
              headers: {
                "Content-Type": "application/json",
              },
              body: JSON.stringify(payload),
            }
          );
          return await messages.json();
        } catch (error) {
          console.error("Error fetching messages:", error);
        }
      }

      function messageTemplate(message) {
        return `
          <li class="message ${message.senderId === userId ? "sent" : ""}">
            ${message.message}
          </li>
        `;
      }

setInterval(() => {
        fetchMessages();
      }, 1000);


      document
        .getElementById("sendMessage")
        .addEventListener("click", async () => {
          let messageText = document.getElementById("messageText").value;
          if (!messageText) return;

          let messages = await createMessages(messageText);
          document.getElementById("messageText").value = "";
          if (messages.isCreated) {
            fetchMessages();
          }
        });
      fetchUser();
    </script>
  </body>
</html>
